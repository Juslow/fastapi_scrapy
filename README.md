# FastAPI & Scrapy 
## Описание
### API
1. `POST /weather/{city}`, где `{city}` - название города на английском языке. Запись в БД города.
2. `GET /last_weather`. Возвращает список существующих городов с последней записанной температурой. 
Если указать опциональный параметр `?search={search}`, то выходной список городов фильтруется 
по частичному совпадению названия города со значением параметра.
3. `GET /city_stats`. Получает по заданному городу (передается query параметром) все данные за выбранный период, а также их средние значения за этот период.
Параметры `date_time_start` и `date_time_end` имеют формат `yyyy-mm-dd-hour-minute`. Например, 2023-02-01-15-00 соответсвует 15:00 01.02.2023.
### Scrapy
Из MySQL БД получает список городов. Города попадают в БД через API (см. выше). 
Для этого списка раз в 1 минуту Scrapy парсит температуру по Цельсию, атмосферное давление и скорость ветра с openweathermap.org и записывает их в БД.
### MySQL
Проект является довольно простым с точки зрения хранения информации и взаимодействия с ней.
MySQL прост в применении и хорошо используется для небольших проектов, поэтому и был выбран MySQL.
## Инструкция по запуску через Docker Compose
1. Измените текущий рабочий каталог (в Git Bash) на тот, в который вы хотите клонировать проект.
    ```
    $ git clone https://github.com/Juslow/fastapi_scrapy.git
    ```
2. Файл `.env.example` переименовать в `.env`
3. Внутри файла `.env` изменить значения переменных. 
    - **APPID** - API ключ openweather.com (можно найти в личном кабинете)
    - **MYSQL_USER=root** - поле для MySQL username (можно не менять, если логиниться с помощью root-пользователя)
    - **MYSQL_PASSWORD=<root_password>** - пароль
    - Остальные переменные можно оставить как есть
4. Создаем Docker image 
    ```
    $ docker build --tag docker-image .
    ```
5. Запускаем контейнер с помощью Docker Compose
    ```
    $ docker compose up -d
    ```
6. Открываем localhost:8000 в браузере

**Примечание:** Контейнер приложения (web) запускается только после запуска контейнера БД (db). 
Поэтому вероятно придется запустить повторно контейнер web, после начала работы контейнера db.
